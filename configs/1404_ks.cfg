#Generated by Kickstart Configurator
#platform=AMD64 or Intel EM64T

#System language
lang en_US
#Language modules to install
langsupport en_US
#System keyboard
keyboard us
#System mouse
mouse
#System timezone
timezone America/New_York
#Root password
rootpw --disabled
#Initial user
user imageadmin --fullname "" --password imageadmin
#Use text mode install
text
#Install OS instead of upgrade
install
#Use CDROM installation media
cdrom
#System bootloader configuration
bootloader --location=mbr
#Clear the Master Boot Record
zerombr yes


#Partition clearing information
clearpart --all --initlabel
#Disk partitioning done with preseed


#System authorization information
auth  --useshadow  --enablemd5
#Firewall configuration
firewall --disabled
#Do not configure the X Window System
skipx

%packages
@ ubuntu-server
openssh-server

%post
# Can't do this directly since the user doesn't exist yet(kickstart post is called early in the finish process)
# We'll run this with a preseed late command
cat <<SCRIPTCOPY >/tmp/setupkeys.sh
#!/bin/sh
# Copy our public ssh key
mkdir --mode=700 /home/imageadmin/.ssh
cat <<EOF > /home/imageadmin/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCW6oY4R/VI7ThLsn1sscB7vq/pqSRKwUaI71Z48h470nOGKn0/gcbv2B5XpV37/ELV398vCt3NdMNnFD4clzlUuh/fYgaus2a7n4xZf0odwPNqybBMB2Kqrwx9zIpylRMHZKmB/ecb2rI+9JNl+7oBmUAW6vKJQH+my5GK6X2d5qA8apMwcnfC1c3EoOBltYE4il9IGDiIZapEjlZuNa9Es99cQB3/XDFEzMJ2IpYNBYxQXcSGD2qrIP+ANBpbkxGmQDiaajtG5fwJ3/yzXlrOF3iDVtYI+0WciRT/a4wucelTGXFWiGOiAPDxfGyr7exvlCrhzpbFS90iOv4xvZ/H ICPC ImageAdmin Key
EOF
chmod 600 /home/imageadmin/.ssh/authorized_keys
chown -R imageadmin:imageadmin /home/imageadmin/.ssh
rm /tmp/setupkeys.sh
SCRIPTCOPY
chmod 755 /tmp/setupkeys.sh

# Enable passwordless sudo
sed -i -e 's/%sudo	ALL=(ALL:ALL) ALL/%sudo	ALL=NOPASSWD:ALL/g' /etc/sudoers
